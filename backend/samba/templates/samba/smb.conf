# This file is generated automatically by openATTIC and will be overwritten
# whenever the configuration changes.
#
# To make changes to this file, copy
#   /usr/share/openattic/samba/templates/samba/smb.conf to
#   /etc/openattic/templates/samba/smb.conf,
# edit the copied file, and then run:
#   dbus-send --system --print-reply --dest=org.openattic.systemd /samba org.openattic.systemd.writeconf string: string:
# to regenerate /etc/samba/smb.conf from the new template.

{% comment %}
 Copyright (C) 2011-2015, it-novum GmbH <community@openattic.org>

 openATTIC is free software; you can redistribute it and/or modify it
 under the terms of the GNU General Public License as published by
 the Free Software Foundation; version 2.

 This package is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.
{% endcomment %}

[global]
   netbios name = {{ Hostname|upper }}

{% if Workgroup %}
   workgroup    = {{ Workgroup|upper }}
{% else %}
   workgroup    = WORKGROUP
{% endif %}

{% if not Domain %}
   security     = share
   guest only   = yes
   map to guest = bad user
   force user   = openattic
{% else %}
   realm        = {{ Domain|upper }}
   security     = ADS

   encrypt passwords = yes
   vfs objects = shadow_copy2 acl_xattr

   kerberos method = dedicated keytab
   dedicated keytab file = /etc/krb5.keytab

   idmap config *:backend = tdb
   idmap config *:range   = 1000000-1999999

   idmap config {{ Workgroup|upper }}:backend = rid
   idmap config {{ Workgroup|upper }}:range   = 10000-999999

   winbind nss info = rfc2307
   winbind trusted domains only = no
   winbind use default domain = yes
   winbind enum users  = no
   winbind enum groups = no
   template shell = /bin/true
{% endif %}

   sync always = yes
   guest account = openattic

{% for share in Shares %}
[{{ share.name }}]
   path       = {{ share.path }}
   available  = {{ share.available|yesno }}
   browseable = {{ share.browseable|yesno }}
   guest ok   = {{ share.guest_ok|yesno }}
   writeable  = {{ share.writeable|yesno }}
   {% if share.comment %}comment    = {{ share.comment }}{% endif %}
   shadow:snapdir = .snapshots
   shadow:format  = %Y-%m-%d-%H-%M-%S
{% endfor %}
